Chapter 10. Detecting and Subverting Firewalls and Intrusion Detection Systems | Nmap Network Scanning Chapter 10. Detecting and Subverting Firewalls and Intrusion Detection Systems - Introduction - Why Would Ethical Professionals (White-hats) Ever Do This? - Determining Firewall Rules - Bypassing Firewall Rules - Exotic Scan Flags - Source Port Manipulation - IPv6 Attacks - IP ID Idle Scanning - Multiple Ping Probes - Fragmentation - Proxies - MAC Address Spoofing - Source Routing - FTP Bounce Scan - Take an Alternative Path - A Practical Real-life Example of Firewall Subversion - Subverting Intrusion Detection Systems - Intrusion Detection System Detection - Avoiding Intrusion Detection Systems - Misleading Intrusion Detection Systems - DoS Attacks Against Reactive Systems - Exploiting Intrusion Detection Systems - Ignoring Intrusion Detection Systems - Detecting Packet Forgery by Firewall and Intrusion Detection Systems Many Internet pioneers envisioned a global open network with a universal IP address space allowing virtual connections between any two nodes. This allows hosts to act as true peers, serving and retrieving information from each other. People could access all of their home systems from work, changing the climate control settings or unlocking the doors for early guests. This vision of universal connectivity has been stifled by address space shortages and security concerns. In the early 1990s, organizations began deploying firewalls for the express purpose of reducing connectivity. Huge networks were cordoned off from the unfiltered Internet by application proxies, network address translation devices, and packet filters. The unrestricted flow of information gave way to tight regulation of approved communication channels and the content that passes over them. Network obstructions such as firewalls can make mapping a network exceedingly difficult. It will not get any easier, as stifling casual reconnaissance is often a key goal of implementing the devices. Nevertheless, Nmap offers many features to help understand these complex networks, and to verify that filters are working as intended. It even supports mechanisms for bypassing poorly implemented defenses. One of the best methods of understanding your network security posture is to try to defeat it. Place yourself in the mind-set of an attacker and deploy techniques from this chapter against your networks. Launch an FTP bounce scan, idle scan, fragmentation attack, or try to tunnel through one of your own proxies. In addition to restricting network activity, companies are increasingly monitoring traffic with intrusion detection systems (IDS). All of the major IDSs ship with rules designed to detect Nmap scans because scans are sometimes a precursor to attacks. Many of these products have morphed into intrusion prevention systems (IPS) that actively block traffic deemed malicious. Unfortunately for network administrators and IDS vendors, reliably detecting bad intentions by analyzing packet data is a tough problem. Attackers with patience, skill, and the help of certain Nmap options can usually pass by IDSs undetected. Meanwhile, administrators must cope with large numbers of false positive results where innocent activity is misdiagnosed and alerted on or blocked.